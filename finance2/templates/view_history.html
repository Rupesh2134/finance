{% extends 'base.html' %}
{% block content %}
  <h2>Payment History â€” {{ username }}</h2>
  <p>
    <a href="{{ url_for('download', username=username) }}" class="btn btn-outline-secondary btn-sm">Download CSV</a>
    <a href="{{ url_for('record_payment') }}" class="btn btn-primary btn-sm ms-2">Record Payment</a>
  </p>

  {% if not records %}
    <p>No records yet for this user.</p>
  {% else %}
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Date</th>
            <th>Payment Amount</th>
            <th>Remaining Balance</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          {% for r in records %}
            <tr>
              <td>{{ r['Date'] }}</td>
              <td>{{ r['Payment_Amount'] }}</td>
              <td>{{ r['Remaining_Balance'] }}</td>
              <td>{{ r['Notes'] }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mt-3">
      <strong>Total Paid:</strong> {{ '%.2f'|format(total_paid) }}
      <br>
      <strong>Remaining Balance:</strong> {{ '%.2f'|format(remaining_balance if remaining_balance is not none else 0) }}
    </div>
  {% endif %}
{% endblock %}
